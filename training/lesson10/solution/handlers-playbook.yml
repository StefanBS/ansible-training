##
# Example: ansible-playbook -i inventory handlers-playbook.yml -k -K
##

---
- hosts: myinstance
  become: true
  user: studentxx

  tasks:

    - block:

      - name: Install Apache Packages
        package:
          name: httpd
          state: present
        notify: Restart httpd service

      - name: Copy Apache config file
        copy:
          src: httpd.conf
          dest: /etc/httpd/httpd.conf
        notify: Restart httpd service

      rescue:

        - name: Print error message
          debug:
            msg: "Could not install httpd package. Continue installing php"

      always:

        - name: Install php package
          package:
            name: php
            state: present

        - name: Create php directory under /var/www/html
          file:
            path: /var/www/html/php
            state: directory

        - name: Copy php web page file
          copy:
            src: index.php
            dest: /var/www/html/php/index.php

  handlers:

    - name: Restart httpd service
      service:
        name: httpd
        state: restarted
        enabled: yes
